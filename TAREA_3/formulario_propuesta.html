<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="formulario_propuesta.css">
    <title>Formulario Propuestas</title>
</head>

<body>
    <form action="" method="get" onsubmit="return validarFormulario();">

        <div id="imagen">
            <img src="../img/resources/Escudo_Plasencia.png" alt="">
        </div>

        <hr>

        <h1>FORMULARIO DE PROPUESTAS<br>PRESUPUESTOS PARTICIPATIVOS</h1>

        <hr>

        <!-- Checkbox para ocultar los datos económicos o mostrarlos -->
        <label for="datos_economicos">Ocultar datos económicos</label>
        <input type="checkbox" id="datos_economicos_checkbox" onclick="mostrarPresupuesto();" checked>
        <br><br>


        <div id="gris">DATOS DE LA PROPUESTA</div>

        <br>


        <fieldset>
            <legend>DATOS PERSONALES</legend>

            <label for="nombre">Nombre </label>
            <input type="text" name="nombre" id="nombre" value="" size="107"><br><br>

            <label for="apellidos">Apellidos </label>
            <input type="text" name="apellidos" id="apellidos" value="" size="106"><br><br>

            <label for="nif">NIF/CIF </label>
            <input type="text" name="nif" id="nif" value="" size="50">

            <label for="telefono">Teléfono </label>
            <input type="text" name="telefono" id="telefono" value="" size="41"><br><br>

            <label for="correo">Correo electrónico </label>
            <input type="text" name="correo" id="correo" value="" size="96"><br><br>

            <label for="precargar">Precargar datos </label>
            <input type="checkbox" id="precargar" onchange="precargar_datos();">

        </fieldset>

        <br>

        <fieldset>
            <legend>TITULO DE LA PROPUESTA</legend>
            <textarea name="titulo" id="titulo" cols="112" rows="2"></textarea>
        </fieldset>

        <br>

        <fieldset>
            <legend>DESCRIPCION DE LA PROPUESTA</legend>
            <textarea name="descripcion" id="descripcion" cols="112" rows="6" placeholder="Breve descripción de la propuesta (por ejemplo, poner una fuente en Main St.)"></textarea>
        </fieldset>

        <br>

        <fieldset id="fieldset-destinatarios">
            <legend>DESTINATARIOS</legend>

            <input type="checkbox" name="ninos" id="ninos">
            <label for="ninos">Niños</label>

            <input type="checkbox" name="jovenes" id="jovenes">
            <label for="jovenes">Jovenes</label>

            <input type="checkbox" name="ancianos" id="ancianos">
            <label for="ancianos">Ancianos</label>

        </fieldset>

        <br>

        <fieldset>
            <legend>BENEFICIOS DE LA PROPUESTA</legend>

            <input type="checkbox" name="infraestructuras" id="infraestructuras">
            <label for="infraestructuras">Mejora de las infraestructuras del municipio</label>

            <input type="checkbox" name="demanda" id="demanda">
            <label for="demanda">Alta demanda</label>

            <br><br>

            <input type="checkbox" name="urbanistica" id="urbanistica">
            <label for="urbanistica">Mejora de la estructura urbanística del municipio</label>

            <input type="checkbox" name="turistica" id="turistica">
            <label for="turistica">Mejora de la estructura turística del municipio</label>

            <br><br>

            <input type="checkbox" name="checkboxOtro" id="checkboxOtro">
            <input type="text" name="inputOtro" id="inputOtro" placeholder="Cualquier otro beneficio..." size="112">

        </fieldset>

        <br>

        <fieldset id="presupuesto_propuesta">
            <legend>PRESUPUESTOS DE LA PROPUESTA</legend>

            <input type="radio" name="presupuesto" id="menosmil">
            <label for="menosmil">Menos de 1000€</label>

            <input type="radio" name="presupuesto" id="milacinco">
            <label for="milacinco">De 1000 a 5000€</label>

            <input type="radio" name="presupuesto" id="cincoadiez">
            <label for="cincoadiez">De 5000 a 10000€</label>

        </fieldset>

        <br>

        <fieldset id="fieldset-duracion">
            <legend>DURACIÓN DE LA PROPUESTA</legend>

            <label for="fechainicio">Fecha de inicio de la propuesta</label>
            <input type="date" name="fechainicio" id="fechainicio">

            <label for="fechafin">Fecha de fin de la propuesta</label>
            <input type="date" name="fechafin" id="fechafin">

        </fieldset>

        <br>

        <fieldset>
            <legend>DOCUMENTACIÓN APORTADA</legend>

            <p>Puede añadir fotos o cualquier otro documento que estime oportuno para la propuesta</p>
            <input type="file" name="archivo" id="archivo">

        </fieldset>

        <hr>

        <button type="reset">Borrar formulario</button>
        <button type="submit" id="enviar">Enviar</button>

        <br>

        <div id="imagen">
            <img src="../img/resources/LogoPl.png" alt="logo">
        </div>

    </form>
    <script>

        const SEPARADOR_EMAIL = '@';

        function validarFormulario() {
            if (campos_obligatorios() == false){
            }
            if (validarTelefono() == false) {
                alert("El formato del telefono introducido es incorrecto.");
            }
            if (validarDNI() == false) {
                alert("El formato del DNI introducido es incorrecto.");
            }
            if (validarEmail() == false) {
                alert("El formato del correo electrónico es incorrecto")
            }
        }

        // Validamos que el formato del DNI está correctamente escrito
        function validarDNI() {
            let valorRetorno = true;
            let contenidoDNI = document.getElementById("nif").value;

            // Validación del formato del DNI
            const patronDNI = /^\d{8}([A-Z]||[a-z])$/;
            if (patronDNI.test(contenidoDNI) == false) {
                valorRetorno = false;
            }

            // Validación de la letra del DNI
            let letras = ['T', 'R', 'W', 'A', 'G', 'M', 'Y', 'F', 'P', 'D', 'X', 'B', 'N', 'J', 'Z', 'S', 'Q', 'V', 'H', 'L', 'C', 'K', 'E', 'T'];
            let letraDNI = letras[contenidoDNI.substring(0, 8) % 23];
            if (letraDNI != contenidoDNI.charAt(8)) {
                valorRetorno = false;
            }

            return valorRetorno;
        }

        function validarTelefono() {
            let valorRetorno = true;
            let contenidoTelefono = document.getElementById("telefono").value;
            const patronTlf = /^[6789]\d{8}$/;
            if (patronTlf.test(contenidoTelefono) == false) {
                valorRetorno = false;
            }

            return valorRetorno;
        }

        // Validamos que el formato del email está correctamente escrito
        function validarEmail() {
            let valorRetorno = true; // Consideramos que la @ de correo es correcta
            let email = (document.getElementById('correo').value).trim();
            let vEmail = email.split('@');
            if (vEmail.length != 2) {
                valorRetorno = false;
            } else {
                let nombre = vEmail[0];
                let dominio = vEmail[1];
                if (nombre.length == "") {
                    valorRetorno = false;
                } else {
                    let vDominio = dominio.split('.');
                    if (vDominio.length <= 1) {
                        valorRetorno = false;
                    } else {
                        for (let i = 0; ((i < vDominio.length) && (valorRetorno != false)); i++) {
                            if (vDominio[i].length == "") {
                                valorRetorno = false;
                            }
                        }
                    }
                }
            }

            let vCaracterNoPermitido = ['$', '%', '€', '*', '+', '-', ';', ',', '{', '}', '?', '/', '\"', '\'', '\\', '|', '/']; // Alguno más ....
            for (let j = 0; ((j < vCaracterNoPermitido.length) && (valorRetorno != false)); j++) {
                if (email.includes(vCaracterNoPermitido[j]) == true) {
                    valorRetorno = false;
                }
            }

            return valorRetorno;
        }
        // Al pulsar el checkbox, deben autocompletarse los campos
        function precargar_datos() {

            var checkbox = document.getElementById("precargar");

            if (checkbox.checked) {
                let contenidoNombre = document.getElementById("nombre").value = "Alejandro";
                let contenidoApellido = document.getElementById("apellidos").value = "Sanchez Collado";
                let contenidoNIF = document.getElementById("nif").value = "54619317K";
                let contenidoNumero = document.getElementById("telefono").value = "664113320";
                let contenidoMail = document.getElementById("correo").value = "asanchezc168@gmail.com";
            } else {
                let contenidoNombre = document.getElementById("nombre").value = "";
                let contenidoApellido = document.getElementById("apellidos").value = "";
                let contenidoNIF = document.getElementById("nif").value = "";
                let contenidoNumero = document.getElementById("telefono").value = "";
                let contenidoMail = document.getElementById("correo").value = "";
            }
        }

        //  Cuando el checkbox esté marcado, se ocultará la sección de 
        // "PRESUPUESTOS DE LA PROPUESTA"
        function mostrarPresupuesto() {
            let checkbox = document.getElementById("datos_economicos_checkbox");
            let seccionPresupuesto = document.getElementById("presupuesto_propuesta");

            if (checkbox.checked) {
                seccionPresupuesto.style.display = "none";
            } else {
                seccionPresupuesto.style.display = "block"
            }
        }

        mostrarPresupuesto();

        // Validamos que los campos que son obligatorios estén rellenados
        function campos_obligatorios() {
            let valorRetorno = true;
            // Son obligatorios DATOS PERSONALES, TITULO DE LA PROPUESTA, DESCRIPCION DE LA
            // PROPUESTA, DESTINATARIOS, BENEFICIOS DE LA PROPUESTA, DURACIÓN DE LA PROPUESTA

            // DATOS PERSONALES
            let campoNombre = document.getElementById("nombre").value;
            let campoApellido = document.getElementById("apellidos").value;
            let campoNIF = document.getElementById("nif").value;
            let campoTelefono = document.getElementById("telefono").value;
            let campoMail = document.getElementById("correo").value;

            // TITULO DE LA PROPUESTA
            let campoTitulo = document.getElementById("titulo").value;

            // DESCRIPCIÓN DE LA PROPUESTA
            let campoDescripcion = document.getElementById("descripcion").value;

            // DESTINATARIOS
            let campoNinos = document.getElementById("ninos");
            let campoJovenes = document.getElementById("jovenes");
            let campoAncianos = document.getElementById("ancianos");

            // BENEFICIOS DE LA PROPUESTA
            let campoInfraestructuras = document.getElementById("infraestructuras");
            let campoDemanda = document.getElementById("demanda");
            let campoUrbanistica = document.getElementById("urbanistica");
            let campoTuristica = document.getElementById("turistica");
            let campoCheckOtro = document.getElementById("checkboxOtro");
            let campoInputOtro = document.getElementById("inputOtro");
            
            // DURACIÓN DE LA PROPUESTA
            let campoFechaInicio = document.getElementById("fechainicio").value;
            let campoFechaFin = document.getElementById("fechafin").value;

            // CONTROL DEL CAMPO NOMBRE
            if (campoNombre === "") {
                alert("El campo nombre es obligatorio.");
                valorRetorno = false;
            }
            

            // CONTROL DEL CAMPO APELLIDO
            if (campoApellido === "") {
                alert("El campo apellido es obligatorio");
                valorRetorno = false;
            }
            

            // CONTROL DEL CAMPO NIF/CIF
            if (campoNIF === "") {
                alert("El campo NIF/CIF es obligatorio");
                valorRetorno = false;
            }


            // CONTROL DEL CAMPO TELEFONO
            if (campoTelefono === "") {
                alert("El campo teléfono es obligatorio");
                valorRetorno = false;
            }


            // CONTROL DEL CAMPO EMAIL
            if (campoMail === "") {
                alert("El campo correo electrónico es obligatorio.");
                valorRetorno = false;
            }
            

            // CONTROL DEL CAMPO TITULO
            if (campoTitulo === "") {
                alert("El campo título es obligatorio");
                valorRetorno = false;
            }


            // CONTROL DEL CAMPO DESCRIPCION
            if (campoDescripcion === "") {
                alert("El campo descripción es obligatorio");
                valorRetorno = false;
            }
            

            // CONTROL DEL APARTADO DESTINATARIOS
            if (!campoNinos.checked && !campoJovenes.checked && !campoAncianos.checked) {
                alert("Seleccione niños, jóvenes o ancianos en el apartado \"Destinatarios\"");
                valorRetorno = false;
            }

            // CONTROL EN EL APARTADO BENEFICIOS DE LA PROPUESTA
            
            // En este primer IF, compruebo que los checkboxes están todos desmarcados.
            if (!campoInfraestructuras.checked && !campoDemanda.checked && !campoUrbanistica.checked && !campoTuristica.checked && !campoCheckOtro.checked) {
                alert("El apartado beneficios de la propuesta es obligatorio");
                valorRetorno = false;
            }

            // En este segundo IF si el checkbox "Cualquier otro beneficio" está marcado, compruebo si el input asociado está vacío.
            if (campoCheckOtro.checked && campoInputOtro.value === "") {
                alert("El campo 'Cualquier otro beneficio' es obligatorio rellenarlo cuando es seleccionado.");
                valorRetorno = false;
            }

            // CONTROL DEL APARTADO DURACIÓN DE LA PROPUESTA.
            if (campoFechaInicio === "" || campoFechaFin === ""){
                alert("Por favor, introduzca una fecha de inicio y una de fin, este campo es obligatorio.");
            }

            return valorRetorno;
        }
    </script>
</body>

</html>